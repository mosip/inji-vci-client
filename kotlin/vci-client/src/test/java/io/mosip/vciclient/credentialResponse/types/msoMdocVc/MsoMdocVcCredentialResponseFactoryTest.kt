package io.mosip.vciclient.credentialResponse.types.msoMdocVc

import android.os.Build
import io.mockk.every
import io.mockk.mockkObject
import io.mosip.vciclient.common.BuildConfig
import org.junit.Assert.assertEquals
import org.junit.Before
import org.junit.Test


class MsoMdocVcCredentialResponseFactoryTest {
    @Before
    fun setUp() {
        mockkObject(BuildConfig)
        every { BuildConfig.getVersionSDKInt() } returns Build.VERSION_CODES.O
    }

    @Test
    fun `should return respective credential in readable format for the given base64 string which is cbor encoded`() {
        val expectedMsoMdocParsedResponse =
            "{\"credential\":{\"docType\":\"org.iso.18013.5.1.mDL\",\"issuerSigned\":{\"issuerAuth\":[{\"1\":null},{\"33\":[\"0�\\u0001�0�\\u0001v�\\u0003\\u0002\\u0001\\u0002\\u0002\\u0014`oEE�ɬ��!e8�9\\u0001�t\\b\\u0010�0\\n\\u0006\\b*�H�=\\u0004\\u0003\\u00020h1\\u000b0\\t\\u0006\\u0003U\\u0004\\u0006\\u0013\\u0002IN1\\u00120\\u0010\\u0006\\u0003U\\u0004\\b\\f\\tKarnataka1\\f0\\n\\u0006\\u0003U\\u0004\\u0007\\f\\u0003BLR1\\u000e0\\f\\u0006\\u0003U\\u0004\\n\\f\\u0005MOSIP1\\u000e0\\f\\u0006\\u0003U\\u0004\\u000b\\f\\u0005MOSIP1\\u00170\\u0015\\u0006\\u0003U\\u0004\\u0003\\f\\u000eMock VC Issuer0\\u001e\\u0017\\r240821082251Z\\u0017\\r250821082251Z0h1\\u000b0\\t\\u0006\\u0003U\\u0004\\u0006\\u0013\\u0002IN1\\u00120\\u0010\\u0006\\u0003U\\u0004\\b\\f\\tKarnataka1\\f0\\n\\u0006\\u0003U\\u0004\\u0007\\f\\u0003BLR1\\u000e0\\f\\u0006\\u0003U\\u0004\\n\\f\\u0005MOSIP1\\u000e0\\f\\u0006\\u0003U\\u0004\\u000b\\f\\u0005MOSIP1\\u00170\\u0015\\u0006\\u0003U\\u0004\\u0003\\f\\u000eMock VC Issuer0Y0\\u0013\\u0006\\u0007*�H�=\\u0002\\u0001\\u0006\\b*�H�=\\u0003\\u0001\\u0007\\u0003B\\u0000\\u0004&9�\\t-EݑO,\\b,/��\\u001f%(�H!�\\u0018�+\$��\\u0002�^���j\\u0014\$��N�ϥҩLGFf���t��?�h �[�H0\\n\\u0006\\b*�H�=\\u0004\\u0003\\u0002\\u0003I\\u00000F\\u0002!\\u0000�q�\\u001b�A\\u0007K�˃P=��\\u0003��q�y�p�\\u0007R�ț��\\u0002!\\u0000鱢��}/�\\u000f���O�g�cv*x��e*\\nhC�\\u0010��Y\",\"0�\\u0001�0�\\u0001v�\\u0003\\u0002\\u0001\\u0002\\u0002\\u0014b99r��\\u001d��E\\u0006+��\\u0001�t\\n��0\\n\\u0006\\b*�H�=\\u0004\\u0003\\u00020h1\\u000b0\\t\\u0006\\u0003U\\u0004\\u0006\\u0013\\u0002IN1\\u00120\\u0010\\u0006\\u0003U\\u0004\\b\\f\\tKarnataka1\\f0\\n\\u0006\\u0003U\\u0004\\u0007\\f\\u0003BLR1\\u000e0\\f\\u0006\\u0003U\\u0004\\n\\f\\u0005MOSIP1\\u000e0\\f\\u0006\\u0003U\\u0004\\u000b\\f\\u0005MOSIP1\\u00170\\u0015\\u0006\\u0003U\\u0004\\u0003\\f\\u000eMock VC Issuer0\\u001e\\u0017\\r240821082557Z\\u0017\\r250821082557Z0h1\\u000b0\\t\\u0006\\u0003U\\u0004\\u0006\\u0013\\u0002IN1\\u00120\\u0010\\u0006\\u0003U\\u0004\\b\\f\\tKarnataka1\\f0\\n\\u0006\\u0003U\\u0004\\u0007\\f\\u0003BLR1\\u000e0\\f\\u0006\\u0003U\\u0004\\n\\f\\u0005MOSIP1\\u000e0\\f\\u0006\\u0003U\\u0004\\u000b\\f\\u0005MOSIP1\\u00170\\u0015\\u0006\\u0003U\\u0004\\u0003\\f\\u000eMock VC Issuer0Y0\\u0013\\u0006\\u0007*�H�=\\u0002\\u0001\\u0006\\b*�H�=\\u0003\\u0001\\u0007\\u0003B\\u0000\\u0004\\n\\u0016�5W_\\u0006Z���wh\\u000f�\\u0003U���Mx\u007F�c�i%?\u007F\\rΞ��\\u001c�㫹B;\\u0014{�����\\u001eIY\\u0011/\\u001cH�ё��:�\\r0\\n\\u0006\\b*�H�=\\u0004\\u0003\\u0002\\u0003H\\u00000E\\u0002!\\u0000��fD��B���g3Yi\\u0010K|�Q��\u007Fu�\\u00101��(<�\\u0002 }�qR�\\u0003\\u0004o�K���j�\\u0000�c�\\u0004Oa\\u001b��\\u001d!�_\\u0013|�\"]},{\"version\":\"1.0\",\"digestAlgorithm\":\"SHA-256\",\"docType\":\"org.iso.18013.5.1\",\"valueDigests\":{\"org.iso.18013.5.1\":{\"2\":\"ԑ\\u0001}\\\"�;k�t\\u0007�M\\r&\\u001a'�\\u000f\\u0010?�ӥ�(��/|\",\"6\":\"�Vv\\u0005�ܵ�����\\u0006�'p��Uͫ#���0s�Z\\u0015{�\",\"3\":\"�\\u001dHɴdB��ɥ�\\u000bо��0�똂jj\\\"�P\\u0002����\",\"1\":\"x\\t�\\u001dT�U_\\u001e\\u0006\\u0016\\u000f\\u000f\\n'5c[�-�\\\"\\b\\u0003��R�6��y\",\"4\":\",�t[\\u0003\\u0012�\\\\\\u0011�\\u0000�uߞ�\\u0010�d~�6�\\u001d�3�\\u0015��H\",\"0\":\"�C\\u0017���=�,c�,��T\\u0013�H|�\\u0001�\\u0000U�R-��%E \",\"7\":\"\\u0016�4reu[\\u0004�\\u001a�UĎZ�;&��*�c\\u001e 0fb2%gJ\",\"5\":\"<�C��F�*e�q�\\ts\\u001c��:\\u000f�ڃ�c��\\u000bQ�`�\"}},\"deviceKeyInfo\":{\"deviceKey\":{\"1\":\"2\",\"-1\":\"1\",\"-2\":\"�\\u0013��\\u000b5��r�\\f\\u0005,�g�\\r�\\\\��o\\u0005�4\\u001d�ƭ��e\",\"-3\":\"}\\u001d�Bf��\\u0017��Q�T�;\\u000b��ߪQ��ڕ-����\\u0000\"}},\"validityInfo\":{\"signed\":\"2024-09-03T06:12:27Z\",\"validFrom\":\"2024-09-03T06:12:27Z\",\"validUntil\":\"100000-01-01T00:00:00Z\"}},\"V��=�(�<OU&�#��/P<��\\r��n`�[�\\u001bb/\$��\\u001d\\u001fz%�X��(�5ja�z\\u0004�\\u0010��V�`�0��\\u000e/\"],\"nameSpaces\":{\"org.iso.18013.5.1\":[{\"digestID\":\"2\",\"random\":\"m�,��ja��\\fa\\u0017�gC�\",\"elementIdentifier\":\"driving_privileges\",\"elementValue\":\"{issue_date=2023-01-01, vehicle_category_code=A, expiry_date=2043-01-01}\"},{\"digestID\":\"6\",\"random\":\"ܗ�s��h^�\\\\�a�l�F\",\"elementIdentifier\":\"document_number\",\"elementValue\":\"1234567\"},{\"digestID\":\"3\",\"random\":\" ���\\u0011\\u0000�vTW\\u0018�\\u000f@l�\",\"elementIdentifier\":\"issue_date\",\"elementValue\":\"2024-01-12\"},{\"digestID\":\"1\",\"random\":\"㡈��\\u0010Y�o��&U߽o\",\"elementIdentifier\":\"issuing_country\",\"elementValue\":\"Island\"},{\"digestID\":\"4\",\"random\":\"���p����R�=��\\u000b�b\",\"elementIdentifier\":\"expiry_date\",\"elementValue\":\"2025-01-12\"},{\"digestID\":\"0\",\"random\":\"\\u0005�\\\\�\\u0016�h-�G�&�P'�\",\"elementIdentifier\":\"birth_date\",\"elementValue\":\"1994-11-06\"},{\"digestID\":\"7\",\"random\":\"IY�V�S�5\\u001aW+@�\u007Fr�\",\"elementIdentifier\":\"given_name\",\"elementValue\":\"Joseph\"},{\"digestID\":\"5\",\"random\":\"\u007F4{]�y\\u0016,���(2�a�\",\"elementIdentifier\":\"family_name\",\"elementValue\":\"Agatha\"}]}}}}"

        val mdocCredentialResponse = MsoMdocVcCredentialResponseFactory().constructResponse(
            """{
    "credential": "omdkb2NUeXBldW9yZy5pc28uMTgwMTMuNS4xLm1ETGxpc3N1ZXJTaWduZWSiamlzc3VlckF1dGiEQ6EBJqEYIYJZAdUwggHRMIIBdqADAgECAhRgb0VFosmsnekhZTiIOQGRdAgQ1jAKBggqhkjOPQQDAjBoMQswCQYDVQQGEwJJTjESMBAGA1UECAwJS2FybmF0YWthMQwwCgYDVQQHDANCTFIxDjAMBgNVBAoMBU1PU0lQMQ4wDAYDVQQLDAVNT1NJUDEXMBUGA1UEAwwOTW9jayBWQyBJc3N1ZXIwHhcNMjQwODIxMDgyMjUxWhcNMjUwODIxMDgyMjUxWjBoMQswCQYDVQQGEwJJTjESMBAGA1UECAwJS2FybmF0YWthMQwwCgYDVQQHDANCTFIxDjAMBgNVBAoMBU1PU0lQMQ4wDAYDVQQLDAVNT1NJUDEXMBUGA1UEAwwOTW9jayBWQyBJc3N1ZXIwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQmOaMJLUXdkU8sCCwvsvUfJSjssUgh9BiBKyT2qQLPXonS1WoUJK2qTu_PpdKpTEdGZqTp_HT86j_daCCPW8dIMAoGCCqGSM49BAMCA0kAMEYCIQDjgXGKG8BBB0vXy4NQPZDBA5fRcc95hXDSB1KlyJvu9gIhAOmxov_gfS_xD6ahp0-SZ8Jjdip48sVlKgpoQ-kQjYxZWQHUMIIB0DCCAXagAwIBAgIUYjk5coftHffgRQYrnIoBkXQK5_IwCgYIKoZIzj0EAwIwaDELMAkGA1UEBhMCSU4xEjAQBgNVBAgMCUthcm5hdGFrYTEMMAoGA1UEBwwDQkxSMQ4wDAYDVQQKDAVNT1NJUDEOMAwGA1UECwwFTU9TSVAxFzAVBgNVBAMMDk1vY2sgVkMgSXNzdWVyMB4XDTI0MDgyMTA4MjU1N1oXDTI1MDgyMTA4MjU1N1owaDELMAkGA1UEBhMCSU4xEjAQBgNVBAgMCUthcm5hdGFrYTEMMAoGA1UEBwwDQkxSMQ4wDAYDVQQKDAVNT1NJUDEOMAwGA1UECwwFTU9TSVAxFzAVBgNVBAMMDk1vY2sgVkMgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEChbpNVdfBlr-m793aA--A1WQhs5NeH_LY_1pJT9_Dc6exesc5OOruUI7FHvo_PjwyB5JWREvHEjk0ZGZhDq2DTAKBggqhkjOPQQDAgNIADBFAiEAmpdmRP-RQqGyumczWWkQS3y9UbqEf3WhEDHtvO0oPP4CIH38cVKrAwRv3Uu3jPFqrwDJY_8ET2EbpOQdIbBfE3zNWQJKpmd2ZXJzaW9uYzEuMG9kaWdlc3RBbGdvcml0aG1nU0hBLTI1Nmdkb2NUeXBlcW9yZy5pc28uMTgwMTMuNS4xbHZhbHVlRGlnZXN0c6Fxb3JnLmlzby4xODAxMy41LjGoAlgg1JEBfSLNO2vedAfnkk0NJhonng8QP6vTpe6EKI7eL3wGWCDCVnYFuty1v8jUx-QGiSdwu_1Vzasjk_DxMHP9WhV7ywNYII4dSMm0ZELjw8ml5gvQvve-MOrrmIJqaiK3UAKy49vhAVggeAmWHVTwVV8eBhYPDwonNWNbvC2yIggDot5S2zbk8nkEWCAs0XRbAxKYXBGvAJ51357woRDIZH6DNsAdgjPQFbLLSABYIIlDF4uT1D3MLGPsLL-kVBP0SHyxAYcAVf9SLYLUJUUgB1ggFuI0cmV1WwSJGv5VxI5a7Dsm6fIqr2MeIDBmYjIlZ0oFWCA88kOo8KNGtCpl2XH5CXMcgoE6D_fag9xjmPoLUcpgpG1kZXZpY2VLZXlJbmZvoWlkZXZpY2VLZXmkAQIgASFYIMQT0ukLNay9co4MBSy9Z8AN91znyG8FtjQd_8atnpBlIlggfR2TQmaT4xfz01HCVOc7C9Hrnt-qUazM2pUt4NLA8wBsdmFsaWRpdHlJbmZvo2ZzaWduZWTAdDIwMjQtMDktMDNUMDY6MTI6MjdaaXZhbGlkRnJvbcB0MjAyNC0wOS0wM1QwNjoxMjoyN1pqdmFsaWRVbnRpbMB2MTAwMDAwLTAxLTAxVDAwOjAwOjAwWlhAVv2oPaEo5TxPVSbyI_vUL1A81O4NneVuYIxb2RtiLySIkB0feiWaWIWtKMU1amHotHoEhBCZ-VaPYLMw3fsOL2puYW1lU3BhY2VzoXFvcmcuaXNvLjE4MDEzLjUuMYjYGFifpGhkaWdlc3RJRAJmcmFuZG9tUG2FLLW-amGqmgxhF71nQ-dxZWxlbWVudElkZW50aWZpZXJyZHJpdmluZ19wcml2aWxlZ2VzbGVsZW1lbnRWYWx1ZXhIe2lzc3VlX2RhdGU9MjAyMy0wMS0wMSwgdmVoaWNsZV9jYXRlZ29yeV9jb2RlPUEsIGV4cGlyeV9kYXRlPTIwNDMtMDEtMDF92BhYWqRoZGlnZXN0SUQGZnJhbmRvbVDcl4VzmY5oXohcs2H4bJdGcWVsZW1lbnRJZGVudGlmaWVyb2RvY3VtZW50X251bWJlcmxlbGVtZW50VmFsdWVnMTIzNDU2N9gYWFikaGRpZ2VzdElEA2ZyYW5kb21QIL6_sBEAsnZUVxjDD0BsyHFlbGVtZW50SWRlbnRpZmllcmppc3N1ZV9kYXRlbGVsZW1lbnRWYWx1ZWoyMDI0LTAxLTEy2BhYWaRoZGlnZXN0SUQBZnJhbmRvbVDjoYj_8RBZ62-85iZV371vcWVsZW1lbnRJZGVudGlmaWVyb2lzc3VpbmdfY291bnRyeWxlbGVtZW50VmFsdWVmSXNsYW5k2BhYWaRoZGlnZXN0SUQEZnJhbmRvbVCDuJZw1tn5v1LYPe7cC_ZicWVsZW1lbnRJZGVudGlmaWVya2V4cGlyeV9kYXRlbGVsZW1lbnRWYWx1ZWoyMDI1LTAxLTEy2BhYWKRoZGlnZXN0SUQAZnJhbmRvbVAFg1zMFq1oLYxHiib0UCeYcWVsZW1lbnRJZGVudGlmaWVyamJpcnRoX2RhdGVsZWxlbWVudFZhbHVlajE5OTQtMTEtMDbYGFhUpGhkaWdlc3RJRAdmcmFuZG9tUElZm1bdU7M1GlcrQPJ_ctNxZWxlbWVudElkZW50aWZpZXJqZ2l2ZW5fbmFtZWxlbGVtZW50VmFsdWVmSm9zZXBo2BhYVaRoZGlnZXN0SUQFZnJhbmRvbVB_NHtdmXkWLPqVnSgypGGWcWVsZW1lbnRJZGVudGlmaWVya2ZhbWlseV9uYW1lbGVsZW1lbnRWYWx1ZWZBZ2F0aGE="
}"""
        )

        assertEquals(
            expectedMsoMdocParsedResponse, mdocCredentialResponse.toJsonString()
        )

    }
}